<!DOCTYPE html>
<html>

<head>
  <title>Test Suite</title>

  <link rel="stylesheet" href="../phosphorus.css">
  <script src="../lib/fontfaceobserver.standalone.js"></script>
  <script src="../lib/jszip.min.js"></script>
  <script src="../lib/rgbcolor.js"></script>
  <script src="../lib/StackBlur.js"></script>
  <script src="../lib/canvg.js"></script>
  <script src="../phosphorus.dist.js"></script>

  <style>
  #suite-container {
    position: relative;
    border: 1px solid black;
    width: 480px;
    height: 360px;
    margin: 5px;
  }

  table {
    border-collapse: collapse;
  }
  table, td, th {
    border: 1px solid black;
  }

  .cell-name {
    font-family: monospace;
  }
  .cell-result-okay {
    background-color: #4aea4a;
  }
  .cell-result-fail {
    background-color: #ea5b5b;
  }
  .cell-total-time, .cell-project-time {
    text-align: center;
  }
  </style>
</head>

<body>
  <h1>Test suite</h1>

  <p>
    The test suite automatically runs a few Scratch projects and checks to make sure that they function correctly.
    Some test failures are to be expected.
    <a href="https://github.com/forkphorus/forkphorus.github.io/tree/master/tests#readme">More information</a>.
  </p>

  <button id="ui-run-sb3">Run Scratch 3 tests</button>
  <button id="ui-run-sb2">Run Scratch 2 tests</button>

  <div id="suite-container"></div>
  <div id="suite-final-results"></div>
  <table>
    <thead>
      <tr>
        <th><!-- Project Path --></th>
        <th>Result</th>
        <th>Total Time</th>
        <th>Project Time</th>
      </tr>
    </thead>
    <tbody id="suite-table"></tbody>
  </table>

  <script src="suite.js"></script>
  <script>
    (function() {
      'use strict';

      P.suite.defaults.repeatCount = 1;

      const sb3button = document.getElementById('ui-run-sb3');
      const sb2button = document.getElementById('ui-run-sb2');

      function toggleInputs(enabled) {
        sb3button.disabled = !enabled;
        sb2button.disabled = !enabled;
      }
  
      function loadScriptAndRunSuite(path) {
        toggleInputs(false);
        const script = document.createElement('script');
        script.onload = function() {
          P.suite.run().then(() => toggleInputs(true));
        };
        script.src = path;
        document.body.appendChild(script);
      }

      sb3button.addEventListener('click', function() {
        loadScriptAndRunSuite('sb3.js');
        location.hash = '#sb3';
      });
      sb2button.addEventListener('click', function() {
        loadScriptAndRunSuite('sb2.js');
        location.hash = '#sb2';
      });

      if (location.hash === '#sb3') {
        loadScriptAndRunSuite('sb3.js');
      }
      if (location.hash === '#sb2') {
        loadScriptAndRunSuite('sb2.js');
      }
    }());
  </script>
    
</body>

</html>
